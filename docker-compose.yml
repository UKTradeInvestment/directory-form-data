version: '2'
services:

  postgres:
    image: postgres:9.5.2
    env_file: .env-postgres

  webserver:
    build:
      context: .
      dockerfile: Dockerfile

    depends_on: [postgres]
    links: [postgres]
    entrypoint: dockerize -wait tcp://postgres:5432 -timeout 10s
    command: /usr/src/app/docker-entrypoint-webserver.sh
    expose: ["8000"]
    env_file: .env

  queue_worker:
    build:
      context: .
      dockerfile: Dockerfile
    depends_on: [webserver]
    links: [postgres]
    entrypoint: dockerize -wait tcp://postgres:5432 -timeout 10s
    command: /usr/src/app/docker-entrypoint-queue_worker.sh
    env_file: .env
